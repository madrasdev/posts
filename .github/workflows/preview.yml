# This is a basic workflow to create a preview URL before merging

name: PREVIEW

# Controls when the action will run. 
on:
  # Triggers the workflow on pull request only for the main branch
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Checkout
        uses: actions/checkout@v2   
        
      - name: Identify updated file
        run: |
          URL="https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}/files"
          FILES=$(curl -s -X GET -G $URL | jq -r '.[] | .filename')
          if echo $FILES | grep -q ".md"; then
             if [ $FILES -eq 1 ]; then 
                echo "File changed - $FILES"
                echo $FILES
             elif [ ${#i} -eq 3 ]; then
                 echo "Invalid PR"
             fi
            echo "Markdown file changed"
          else
            echo "No Markdown file changed"
          fi              
        
      - name: Move post to madrasdev/blog
        uses: dmnemec/copy_file_to_another_repo_action@master
        env:
          API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
        with:
          source_file: $FILES
          destination_repo: 'https://github.com/madrasdev/blog'
          destination_folder: 'content/post'
          user_email: 'niranjan2020@gmail.com'
          user_name: 'sniranjan'
          commit_message: 'A blog post by ${{ github.actor }}'    
